{% extends 'base.html' %}
{% block content %}
<h2>–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</h2>

<div style="text-align: center; margin-bottom: 20px;">
  <a href="{{ url_for('tasks.add_task') }}">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</a>
</div>

<!-- üîç –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É -->
<div class="filter-bar">
  <label>
    <input type="checkbox" id="hide-done-checkbox">
    –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
  </label>
</div>

<ul id="task-list">
  {% for task in my_tasks %}
    <li data-status="{{ task.status }}">
      <div style="flex: 1;">
        <strong>{{ task.title }}</strong> ‚Äî {{ task.description }}

        <div class="status-badge {{ 'status-done' if task.status == '–≤—ã–ø–æ–ª–Ω–µ–Ω–æ' else 'status-progress' }}">
          {{ task.status }}
        </div>

        <form action="{{ url_for('tasks.update_task_status_cmd', task_id=task.id) }}" method="POST" class="status-form">
          <select name="status" onchange="this.form.submit()">
            <option value="–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ" {% if task.status == '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ' %}selected{% endif %}>–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
            <option value="–≤—ã–ø–æ–ª–Ω–µ–Ω–æ" {% if task.status == '–≤—ã–ø–æ–ª–Ω–µ–Ω–æ' %}selected{% endif %}>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</option>
          </select>
        </form>
      </div>

      <form action="{{ url_for('tasks.delete_task_cmd', task_id=task.id) }}" method="POST" style="display: inline;">
        <button type="submit">üóë –£–¥–∞–ª–∏—Ç—å</button>
      </form>
    </li>
  {% else %}
    <li>–ù–µ—Ç –∑–∞–¥–∞—á.</li>
  {% endfor %}
</ul>

<!-- üîß –°–∫—Ä–∏–ø—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
<script>
  const checkbox = document.getElementById('hide-done-checkbox');
  const taskList = document.getElementById('task-list');

  checkbox.addEventListener('change', () => {
    const tasks = taskList.querySelectorAll('li');
    tasks.forEach(task => {
      const status = task.getAttribute('data-status');
      if (checkbox.checked && status === '–≤—ã–ø–æ–ª–Ω–µ–Ω–æ') {
        task.style.display = 'none';
      } else {
        task.style.display = 'flex';
      }
    });
  });
</script>
{% endblock %}
